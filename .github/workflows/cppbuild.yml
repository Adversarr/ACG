name: cpp-build
on: [push]


jobs:
  ubuntu-job:
    runs-on: ubuntu-latest
    steps:
      # - name: Prepare Vulkan SDK
      #   uses: humbletim/setup-vulkan-sdk@v1.2.0
      #   with:
      #     vulkan-query-version: 1.3.204.0
      #     vulkan-components: Vulkan-Headers, Vulkan-Loader
      #     vulkan-use-cache: true
      #
      # - name: Install Vulkan SDK
      #   uses: humbletim/install-vulkan-sdk@v1.1.1
      #   with:
      #     version: 1.3.204.0
      #     cache: true
      - name: install Vulkan
        run: |
          wget -qO- https://packages.lunarg.com/lunarg-signing-key-pub.asc | sudo tee /etc/apt/trusted.gpg.d/lunarg.asc
          sudo wget -qO /etc/apt/sources.list.d/lunarg-vulkan-jammy.list http://packages.lunarg.com/vulkan/lunarg-vulkan-jammy.list
          sudo apt update
          sudo apt install vulkan-sdk
      - uses: actions/checkout@v3
      - uses: xmake-io/github-action-setup-xmake@v1
        with:
          xmake-version: '2.7.5'
          actions-cache-folder: '.xmake-cache'
      - name: configure
        run: cd ${{ github.workspace }} && xmake f -y --toolchain=clang -m debug
      - name: build
        run: xmake b -v
      - name: run-test
        run: xmake run --group=test
